<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
	<sql-query name="index_photo">
     <![CDATA[
     	SELECT ph.HEADPHOTOPATH AS photo
		FROM t_portal_userphoto ph,(
			SELECT PK_T_PORTAL_ACCOUNT_USERID AS ID
			FROM t_portal_account 
			WHERE UID = :uid ) temp
		WHERE ph.ACCOUNT = temp.ID ;
     ]]>
    </sql-query>
    
    <sql-query name="index_phrase" >
    	<![CDATA[
    	SELECT PHRASE
		FROM t_portal_moodphrase
		WHERE ACCOUNT IN (
			SELECT PK_T_PORTAL_ACCOUNT_USERID
			FROM t_portal_account
			WHERE UID = :uid
		);
    	]]>
    </sql-query>


	<sql-query name="index_count_dongtai">
		SELECT COUNT(sub.id),sub.moduleId
		FROM t_sm2_subject sub,
			(
				SELECT sub_id as subId
				FROM t_sm2_subject_master
				WHERE user_uid = :uid
			)subIds
		WHERE 
			sub.id = subIds.subId 
			AND (sub.status='new' OR sub.status='updated')
		GROUP BY sub.moduleId
	</sql-query>
</hibernate-mapping>
